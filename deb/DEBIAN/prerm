#!/bin/bash
set -e
set -x  # Debug: show commands

RULES_DIR="/usr/share/X11/xkb/rules"
DOC_DIR="/usr/share/doc/salishan-keyboard"
LAYOUT_NAME="salishan"

echo "Removing Salishan keyboard layout entries..."

# -----------------------------
# Remove from .lst files
# -----------------------------
for FILE in base.lst evdev.lst; do
    TARGET_FILE="$RULES_DIR/$FILE"
		if grep -q "  sal             Salishan" "$TARGET_FILE"; then
			 sed -i "/  sal             Salishan/d" "$TARGET_FILE"
        echo "â†’ Removed $LAYOUT_NAME from $TARGET_FILE"
    fi
done

# -----------------------------
# Remove exact XML snippet
# -----------------------------
for FILE in base.xml evdev.xml; do
    TARGET_FILE="$RULES_DIR/$FILE"
    if grep -q "<name>$LAYOUT_NAME</name>" "$TARGET_FILE"; then
        perl -0777 -i -pe 's#<layout>\s*<configItem>\s*<name>salishan</name>.*?</layout>\n##s' "$TARGET_FILE"
        echo "â†’ Removed $LAYOUT_NAME layout block from $TARGET_FILE"
    fi
done

# -----------------------------
# Remove snippets folder
# -----------------------------
rm -rf "$DOC_DIR"

echo "ðŸ§¹ Salishan layout removed."

